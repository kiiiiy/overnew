{% load static %}
<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìµëª… í† ë¡ ë°© - OVERNEW</title>
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
    <link rel="stylesheet" href="{% static 'css/discussionstyle.css' %}">
    <script src="{% static 'js/discussion-anonymous.js' %}" defer></script>
</head>

<body class="with-fixed-comment-bar"
      data-page-type="anonymous"
      data-room-id="{{ room.room_id }}">

    <!-- ì„œë²„ì—ì„œ ë‚´ë ¤ì¤€ ëŒ“ê¸€ íŠ¸ë¦¬ JSONì„ JS ì „ì—­ ë³€ìˆ˜ë¡œ -->
    <script>
    window.INITIAL_COMMENTS = JSON.parse(`{{ comments_json|escapejs }}`);
</script>

    <header class="main-header">
        <button type="button" class="icon-btn menu-btn" id="back-button">
            <span>&lt;</span>
        </button>

        <h1 class="logo header-logo">OVERNEW</h1>
        <div style="width:40px;"></div>
    </header>

    <!-- ìƒë‹¨ ê³ ì •ëœ í† ë¡ ë°© ë°•ìŠ¤ (í•€ ê¸°ëŠ¥ìš©) -->
    <section id="pinned-discussion-box" class="pinned-discussion-box"></section>

    <!-- í† ë¡ ì°½ ë°•ìŠ¤ -->
    <main class="container">
        <div style="height:40px;"></div>

        <div class="discussion-article-header">
            <div class="article-category-source">
                <span class="card-category topic-it">
                    {{ room.article.nc }}
                </span>
                <span class="card-source">
                    {{ room.article.media }}
</span>
            </div>
            <h2 class="article-title">
                {{ room.article.title|default:"êµ­ë¯¼ ê±´ê°• ìœ„í˜‘í•˜ëŠ” 'ìˆ˜ì…ì‹í’ˆ'...AIê°€ ìë™ìœ¼ë¡œ ê±¸ëŸ¬ë‚¸ë‹¤" }}
            </h2>

            <div class="discussion-meta">
                <div class="meta-left">
                    <!-- TODO: ë‚¨ì€ ì‹œê°„, ì°¸ì—¬ì ìˆ˜ëŠ” ë‚˜ì¤‘ì— ì‹¤ì œ ê°’ìœ¼ë¡œ -->
                    <span class="time-left">ğŸ•’ 12 hours left</span>
                    <span class="participant-count">ğŸ’¬ {{ participant_count }}ëª…ì´ í† ë¡ ì— ì°¸ì—¬ì¤‘ì…ë‹ˆë‹¤.</span>
                </div>
                <div class="meta-right">
                    <form method="post"
                          action="{% url 'discussion:toggle_bookmark' room.room_id %}"
                          style="display:inline;">
                        {% csrf_token %}
                        <button type="submit"
                                class="pin-btn pinned-btn"
                                id="pin-btn"
                                title="ì»¤ë®¤ë‹ˆí‹° ìƒë‹¨ì— ê³ ì •">
                            ğŸ“Œ ê³ ì •
                        </button>
                    </form>
                    <button type="button" class="sort-toggle-btn" id="sort-btn">
                        <span>â‡…</span> ìµœì‹ ìˆœ
                    </button>
                </div>
            </div>
        </div>

        <!-- ëŒ“ê¸€ ë¦¬ìŠ¤íŠ¸ -->
        <div class="comment-list" id="comment-list"></div>
    </main>

    <!-- í•˜ë‹¨ ê³ ì • ëŒ“ê¸€ ì…ë ¥ ë°” (í¼ìœ¼ë¡œ create_commentì— POST) -->
    <form class="comment-input-bar"
          method="post"
          action="{% url 'discussion:create_comment' room.room_id %}">
        {% csrf_token %}

        <img src="https://via.placeholder.com/32x32/CCCCCC/FFFFFF?text=ğŸ‘¤"
             alt="ë‚´ í”„ë¡œí•„"
             id="my-avatar"
             class="card-avatar-small">

        <input type="text"
               id="comment-input"
               name="content"
               placeholder="Add a comment"
               autocomplete="off"
               required>

        <!-- ë‹µê¸€ìš© parent_id -->
        <input type="hidden" name="parent_id" id="parent-id-input" value="">

        <!-- ë‹µê¸€ ì·¨ì†Œ ë²„íŠ¼ (JSì—ì„œ show/hide) -->
        <button type="button"
                id="cancel-reply-btn"
                class="cancel-reply-btn"
                style="display:none; margin-left:8px;">
            ì·¨ì†Œ
        </button>

        <!-- ì œì¶œ ë²„íŠ¼ -->
        <button type="submit"
                class="comment-submit-btn"
                id="submit-comment-btn"
                style="border: none; background: none; padding: 0; cursor: pointer; margin-left: 8px;">
            <img src="{% static 'img/icon-upload.png' %}"
                 alt="ì—…ë¡œë“œ"
                 style="width: 32px; height: 32px;">
        </button>
    </form>

</body>
</html>
