{% load static %}
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì‹¤ëª… í† ë¡ ë°© - OVERNEW</title>

    <link rel="stylesheet" href="{% static 'css/style.css' %}">
    <link rel="stylesheet" href="{% static 'css/discussionstyle.css' %}">

    <!-- ì‹¤ëª… í† ë¡ ë°© JS -->
    <script src="{% static 'js/discussion-realname.js' %}" defer></script>
</head>

<body class="with-fixed-comment-bar"
      data-page-type="realname"
      data-room-id="{{ room.room_id }}">

    <!-- ì„œë²„ì—ì„œ ë‚´ë ¤ì¤€ ëŒ“ê¸€ íŠ¸ë¦¬ JSONì„ JS ì „ì—­ ë³€ìˆ˜ë¡œ -->
    <script>
        window.INITIAL_COMMENTS = JSON.parse(`{{ comments_json|escapejs }}`);
    </script>

    <header class="main-header">
        <!-- ë’¤ë¡œê°€ê¸° ë²„íŠ¼ -->
        <button type="button"
                class="icon-btn menu-btn"
                id="back-button"
                data-back-url="{% url 'discussion:main' %}">
            <span>&lt;</span>
        </button>

        <h1 class="logo header-logo">OVERNEW</h1>

        <!-- ì˜¤ë¥¸ìª½ ë¹ˆ ê³µê°„ -->
        <div style="width:40px;"></div>
    </header>

    <!-- (ì˜µì…˜) ìƒë‹¨ ê³ ì • í† ë¡  ë°•ìŠ¤ -->
    <section id="pinned-discussion-box" class="pinned-discussion-box"></section>

    <main class="container">
        <div style="height:40px;"></div>

        <div class="discussion-article-header">
            <div class="article-category-source">
                <!-- ì¹´í…Œê³ ë¦¬ / ë¯¸ë””ì–´: ëª¨ë¸ __str__ ì‚¬ìš© -->
                <span class="card-category topic-it">
                    {{ room.article.nc }}
                </span>

                <span class="card-source">
                    {{ room.article.media }}
                </span>
            </div>

            <h2 class="article-title">
                {{ room.article.title }}
            </h2>

            <div class="discussion-meta">
                <div class="meta-left">
                    <span class="time-left">
                        ğŸ•’ {{ time_left_label }}
                    </span>
                    <span class="participant-count">
                        ğŸ’¬ {{ participant_count }}ëª…ì´ í† ë¡ ì— ì°¸ì—¬ì¤‘ì…ë‹ˆë‹¤.
                    </span>
                </div>

                <div class="meta-right">
                    <form method="post"
                          action="{% url 'discussion:toggle_bookmark' room.room_id %}"
                          style="display:inline;">
                        {% csrf_token %}
                        <button type="submit"
                                class="pinned-btn{% if is_bookmarked %} pinned{% endif %}"
                                id="pin-btn"
                                title="ì»¤ë®¤ë‹ˆí‹° ìƒë‹¨ì— ê³ ì •">
                            {% if is_bookmarked %}
                                ğŸ“Œ ê³ ì •ë¨
                            {% else %}
                                ğŸ“Œ ê³ ì •
                            {% endif %}
                        </button>
                    </form>

                    <button type="button" class="sort-toggle-btn" id="sort-btn">
                        <span>â‡…</span> ìµœì‹ ìˆœ
                    </button>
                </div>
            </div>
        </div>

        <!-- ëŒ“ê¸€ ë¦¬ìŠ¤íŠ¸ -->
        <div id="comment-list"></div>

<!-- ëŒ“ê¸€ ì…ë ¥ í¼ -->
<form method="post" action="{% url 'discussion:create_comment' room.room_id %}">
    {% csrf_token %}
    <!-- ğŸ”¥ ë‹µê¸€ìš© ë¶€ëª¨ ëŒ“ê¸€ ID -->
    <input type="hidden" name="parent_id" id="parent-id-input">

    <div class="comment-input-bar">
        <img id="my-avatar" class="my-avatar" src="https://via.placeholder.com/32x32/CCCCCC/FFFFFF?text=ğŸ‘¤" alt="me">
        <!-- ğŸ”¥ content ì´ë¦„ ì¤‘ìš” -->
        <input id="comment-input" name="content" type="text" placeholder="Add a comment">
        <button type="submit" id="submit-comment-btn">ê²Œì‹œ</button>
        <button type="button" id="cancel-reply-btn" style="display:none;">ì·¨ì†Œ</button>
    </div>
</form>

<!-- ğŸ”¥ ì„œë²„ì—ì„œ ë‚´ë ¤ì¤€ ëŒ“ê¸€ íŠ¸ë¦¬ ì£¼ì… -->
<script>
    window.INITIAL_COMMENTS = JSON.parse(`{{ comments_json|escapejs }}`);
</script>

<!-- ì‹¤ëª… JS -->
<script src="{% static 'js/discussion-realname.js' %}?v=2"></script>
    </main>

    <!-- í•˜ë‹¨ ê³ ì • ëŒ“ê¸€ ì…ë ¥ ë°” (í¼ â†’ create_commentë¡œ POST) -->
    <form class="comment-input-bar"
          method="post"
          action="{% url 'discussion:create_comment' room.room_id %}">
        {% csrf_token %}

        <!-- ì‹¤ëª… í”„ë¡œí•„: ë‚˜ì¤‘ì— ì‹¤ì œ í”„ë¡œí•„ ì´ë¯¸ì§€ë¡œ êµì²´ ê°€ëŠ¥ -->
        <img src="https://via.placeholder.com/32x32/CCCCCC/FFFFFF?text=ë‚˜"
             alt="ë‚´ í”„ë¡œí•„"
             id="my-avatar"
             class="card-avatar-small">

        <input type="text"
               id="comment-input"
               name="content"
               placeholder="Add a comment"
               autocomplete="off"
               required>

        <!-- ë‹µê¸€ìš© parent_id -->
        <input type="hidden" name="parent_id" id="parent-id-input" value="">

        <!-- ë‹µê¸€ ì·¨ì†Œ ë²„íŠ¼ (JSì—ì„œ show/hide) -->
        <button type="button"
                id="cancel-reply-btn"
                class="cancel-reply-btn"
                style="display:none; margin-left:8px;">
            ì·¨ì†Œ
        </button>

        <!-- ì œì¶œ ë²„íŠ¼ -->
        <button type="submit"
                class="comment-submit-btn"
                id="submit-comment-btn">
            ì—…ë¡œë“œ
        </button>
    </form>

</body>
</html>
